import f from"format-message";import{Store as u}from"pullstate";var r=new u({locale:null});var s=f.namespace(),a={languages:[],localeFromPhone:null,defaultFallback:null,locale:null},t={current:null,namespaces:{},translations:{}},c=o=>o&&!t.translations[o]?(console.warn(`Locale "${o}" not found`),null):(a.locale=o,s.setup({locale:a.locale,translations:t.translations[a.locale]}),console.warn("dbg:vvv",s.setup({locale:a.locale,translations:t.translations[a.locale]})),r.update(n=>{n.locale=o}),o),k=({localeFromPhone:o,languages:n,defaultFallback:e=null})=>{if(a.localeFromPhone=o(),!(!n||!Array.isArray(n)||n.length===0)){for(let i of n){let l=i;if(!l.locale){console.warn("Check language pack for locales");continue}if(!l.translations){console.warn(`Not found "translations" object in ${l.locale} locale`);continue}a.languages.push({locale:l.locale,meta:l.meta}),a.defaultFallback||(a.defaultFallback=l.locale),t.translations[l.locale]=l.translations}return e&&!t.translations[e]?console.warn("Fallback language not found in language packs"):e&&(a.defaultFallback=e),console.warn("dbg:buffer.translations",{locale:a.defaultFallback,translations:t.translations[a.defaultFallback]}),s.setup({locale:a.defaultFallback,translations:t.translations[a.defaultFallback]}),c(a.localeFromPhone)}},p=o=>a.languages.map(n=>({selected:o===n.locale,...n})),I=()=>{let o=r.useState(n=>n.locale||a.defaultFallback);return{getLanguages:()=>p(o),locale:o,t:s,changeLocale:c}};export{c as changeLocale,k as initialization,I as useIntl};
