import r from"format-message";import{Store as u}from"pullstate";var s=new u({locale:null});var a={languages:[],localeFromPhone:null,defaultFallback:null,locale:null},t={current:null,namespaces:{},translations:{}},c=l=>l&&!t.translations[l]?(console.warn(`Locale "${l}" not found`),null):(a.locale=l,r.setup({locale:a.locale,translations:{...t.translations[a.locale]}}),console.warn("dbg:vvv",r.setup({locale:a.locale,translations:t.translations[a.locale]})),s.update(o=>{o.locale=l}),l),b=({localeFromPhone:l,languages:o,defaultFallback:e=null})=>{if(a.localeFromPhone=l(),!(!o||!Array.isArray(o)||o.length===0)){for(let i of o){let n=i;if(!n.locale){console.warn("Check language pack for locales");continue}if(!n.translations){console.warn(`Not found "translations" object in ${n.locale} locale`);continue}a.languages.push({locale:n.locale,meta:n.meta}),a.defaultFallback||(a.defaultFallback=n.locale),t.translations[n.locale]={...n.translations}}return e&&!t.translations[e]?console.warn("Fallback language not found in language packs"):e&&(a.defaultFallback=e),console.warn("dbg:buffer.translations",{locale:a.defaultFallback,translations:t.translations[a.defaultFallback]}),r.setup({locale:a.defaultFallback,translations:{...t.translations[a.defaultFallback]}}),c(a.localeFromPhone)}},f=l=>a.languages.map(o=>({selected:l===o.locale,...o})),k=()=>{let l=s.useState(o=>o.locale||a.defaultFallback);return{getLanguages:()=>f(l),locale:l,t:r,changeLocale:c}};export{c as changeLocale,b as initialization,k as useIntl};
