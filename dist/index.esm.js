import s from"format-message";import{Store as u}from"pullstate";var r=new u({locale:null});var a={languages:[],localeFromPhone:null,defaultFallback:null,locale:null},t={current:null,namespaces:{},translations:{}},c=l=>l&&!t.translations[l]?(console.warn(`Locale "${l}" not found`),null):(a.locale=l,console.warn("dbg:000",[a.locale,t.translations[a.locale]]),s.setup({locale:a.locale,translations:t.translations[a.locale]}),console.warn("dbg:vvv",s.setup({locale:a.locale,translations:t.translations[a.locale]})),r.update(o=>{o.locale=l}),l),b=({localeFromPhone:l,languages:o,defaultFallback:e=null})=>{if(a.localeFromPhone=l(),!(!o||!Array.isArray(o)||o.length===0)){for(let i of o){let n=i;if(!n.locale){console.warn("Check language pack for locales");continue}if(!n.translations){console.warn(`Not found "translations" object in ${n.locale} locale`);continue}a.languages.push({locale:n.locale,meta:n.meta}),a.defaultFallback||(a.defaultFallback=n.locale),t.translations[n.locale]=n.translations}return e&&!t.translations[e]?console.warn("Fallback language not found in language packs"):e&&(a.defaultFallback=e),console.warn("dbg:buffer.translations",{locale:a.defaultFallback,translations:t.translations[a.defaultFallback]}),s.setup({locale:a.defaultFallback,translations:t.translations[a.defaultFallback]}),c(a.localeFromPhone)}},f=l=>a.languages.map(o=>({selected:l===o.locale,...o})),k=()=>{let l=r.useState(o=>o.locale||a.defaultFallback);return{getLanguages:()=>f(l),locale:l,t:s,changeLocale:c}};export{c as changeLocale,b as initialization,k as useIntl};
