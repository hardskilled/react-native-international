import f from"format-message";import{Store as u}from"pullstate";var r=new u({locale:null});var s=f.namespace(),a={languages:[],localeFromPhone:null,defaultFallback:null,locale:null},t={current:null,namespaces:{},translations:{}},c=o=>o&&!t.translations[o]?(console.warn(`Locale "${o}" not found`),null):(a.locale=o,s.setup({locale:a.locale,translations:t.translations[a.locale]}),console.warn("dbg:vvv",s.setup({locale:a.locale,translations:t.translations[a.locale]})),r.update(l=>{l.locale=o}),o),b=({localeFromPhone:o,languages:l,defaultFallback:e=null})=>{if(a.localeFromPhone=o(),!(!l||!Array.isArray(l)||l.length===0)){for(let i of l){let n=i;if(!n.locale){console.warn("Check language pack for locales");continue}if(!n.translations){console.warn(`Not found "translations" object in ${n.locale} locale`);continue}a.languages.push({locale:n.locale,meta:n.meta}),a.defaultFallback||(a.defaultFallback=n.locale),t.translations[n.locale]=n.translations}return e&&!t.translations[e]?console.warn("Fallback language not found in language packs"):e&&(a.defaultFallback=e),console.warn("dbg:buffer.translations",{locale:a.defaultFallback,translations:t.translations[a.defaultFallback]}),s.setup({locale:a.defaultFallback,translations:t.translations[a.defaultFallback]}),c(a.localeFromPhone)}},p=o=>a.languages.map(l=>({selected:o===l.locale,...l})),k=()=>{let o=r.useState(l=>l.locale||a.defaultFallback);return{getLanguages:()=>p(o),locale:o,t:s,changeLocale:c}};export{c as changeLocale,b as initialization,k as useIntl};
